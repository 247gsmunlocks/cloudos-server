#
# Cookbook Name:: sso
# Recipe:: restore
#
# Copyright 2014, cloudstead
#
# All rights reserved - Do Not Redistribute
#

bash "restore kerberos / ldap database" do
user "root"
cwd "<%=@backup_dir%>"
code <<-EOF
echo "restoring config files from backup at <%=@backup_dir%>"

cp -rf etc/* /etc

echo "restoring ldap dump files"

service slapd stop
slapadd -F /etc/ldap/slapd.d -n 0 -l <%=@backup_dir%>/config.ldif
slapadd -F /etc/ldap/slapd.d -n 1 -l <%=@backup_dir%>/data.ldif
service slapd start

EOF
end